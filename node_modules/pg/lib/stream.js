/**
 * Get a socket stream compatible with the current runtime environment.
 * @returns {Duplex}
 */
const { CloudflareSocket } = require('pg-cloudflare')

module.exports.getStream = function getStream(ssl) {
  if (ssl) {
    return new CloudflareSocket(ssl)
  } else {
    const net = require('net')
    return new net.Socket()
  }
}

/**
 * Get a TLS secured socket, compatible with the current environment,
 * using the socket and other settings given in `options`.
 * @returns {Duplex}
 */
const { TlsSocket } = require('tls')

module.exports.getSecureStream = function getSecureStream(options) {
  if (options.socket) {
    const socket = options.socket
    delete options.socket
    return new TlsSocket(socket, options)
  } else {
    return new TlsSocket(options)
  }
}

